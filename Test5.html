<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lodge Generator</title>
<style>
  body { background: #222; color: #fff; font-family: sans-serif; }
  svg { border: 1px solid #555; margin: 20px; }
  text { font-size: 12px; dominant-baseline: middle; text-anchor: middle; fill: #fff; }
</style>
</head>
<body>
<svg id="lodge" width="1000" height="1000"></svg>

<script>
const svg = document.getElementById("lodge");
const HEX_SCALE = 1.25; // scaling factor for hex size
const HEX_SIZE = 50 * HEX_SCALE; // base hex size

const DIRECTIONS = [[1,0],[1,-1],[0,-1],[-1,0],[-1,1],[0,1]];

// Room list (name|color)
const roomNames = [
  "Black Rose Room|black",
  "Throne Room|purple",
  "Purple Room 2|purple",
  "Purple Room 3|purple",
  "Red Room 1|red",
  "Red Room 2|red",
  "Red Room 3|red",
  "Green Room 1|green",
  "Green Room 2|green",
  "Green Room 3|green",
  "Blue Room 1|blue",
  "Blue Room 2|blue",
  "Blue Room 3|blue",
  "Gray Room 1|gray",
  "Gray Room 2|gray",
  "Gray Room 3|gray",
  "Yellow Room 1|yellow",
  "Yellow Room 2|yellow",
  "Yellow Room 3|yellow"
];

// Hex grid to pixel (rotated 90Â° clockwise)
function hexToPixel(q, r) {
  const rotatedX = HEX_SIZE * Math.sqrt(3) * (r + q/2);
  const rotatedY = -HEX_SIZE * 3/2 * q;
  return [rotatedX + 500, rotatedY + 500]; // center in SVG
}

// Draw a hex
function drawHex(x, y, color, name) {
  let points = [];
  for (let i = 0; i < 6; i++) {
    const angle = Math.PI / 180 * (60 * i + 30);
    const px = x + HEX_SIZE * Math.cos(angle);
    const py = y + HEX_SIZE * Math.sin(angle);
    points.push(`${px},${py}`);
  }
  const hex = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
  hex.setAttribute("points", points.join(" "));
  hex.setAttribute("fill", color);
  hex.setAttribute("stroke", "#000");
  hex.setAttribute("stroke-width", "2");
  svg.appendChild(hex);

  const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
  text.setAttribute("x", x);
  text.setAttribute("y", y);
  text.textContent = name;
  svg.appendChild(text);
}

// Generate lodge
function generateLodge() {
  while(true) {
    const lodge = new Map();
    lodge.set("0,0", roomNames[0]); // Black Rose Room

    // Track used positions
    const openPositions = [[0,0]];

    // Shuffle remaining rooms
    const remainingRooms = roomNames.slice(1).sort(() => Math.random()-0.5);

    let success = true;

    for(const room of remainingRooms) {
      let placed = false;
      const positions = [...openPositions].sort(() => Math.random()-0.5);

      for(const [q,r] of positions) {
        const neighbors = DIRECTIONS.map(d => [q+d[0], r+d[1]]);
        for(const [nq,nr] of neighbors) {
          const key = `${nq},${nr}`;
          if(!lodge.has(key)) {
            // Check adjacency >= 2 except for first ring
            const adjacentCount = DIRECTIONS.reduce((acc,d)=>{
              const neighborKey = `${nq+d[0]},${nr+d[1]}`;
              return acc + (lodge.has(neighborKey)?1:0);
            },0);
            if(adjacentCount >= 1) {
              lodge.set(key, room);
              openPositions.push([nq,nr]);
              placed = true;
              break;
            }
          }
        }
        if(placed) break;
      }

      if(!placed) {
        success = false;
        break; // restart
      }
    }

    if(success) return lodge;
  }
}

// Draw lodge
const lodge = generateLodge();
for(const [key, val] of lodge.entries()) {
  const [q,r] = key.split(",").map(Number);
  const [x,y] = hexToPixel(q,r);
  const [name, color] = val.split("|");
  drawHex(x, y, color, name);
}
</script>
</body>
</html>
